<!doctype html>
<title>ws_ws: display coordinates</title>
<style>
  canvas { border: 1px solid black; }
</style>

<h1>display coordinates</h1>

<canvas id="c" height=500 width=500></canvas>

<script>
var lastTenCoords = [];

var diamondColors = [ "#f00", "#0f0", "#08f"];
var colorCount = 0;

// canvas setup
var canvas = document.getElementById('c');
var c = canvas.getContext("2d");

c.lineWidth = 3;
c.lineCap = "round";
c.lineJoin = "round"
c.strokeStyle = "#000";

// websocket setup
var ws = new WebSocket("ws://" + window.location.hostname + ":" + (window.location.port || 80) + "/");

ws.onmessage = function(e) {
    var coords = JSON.parse(e.data);
    coords.color = diamondColors[(colorCount++)%diamondColors.length];
    lastTenCoords.push(coords);
    while (lastTenCoords.length > 10) lastTenCoords.shift();
    draw();
};

// drawing functions
function draw() {
  c.clearRect(0, 0, canvas.width, canvas.height);
  lastTenCoords.forEach(function (coords) {
    drawDiamond(c, coords.x*canvas.width/100, coords.y*canvas.height/100, coords.color);
  });
}

function drawDiamond(c, x, y, color) {
  c.save()
  c.beginPath()
  c.moveTo(x-20, y)
  c.lineTo(x, y+20)
  c.lineTo(x+20, y)
  c.lineTo(x, y-8)
  c.lineTo(x-20, y)
  c.fillStyle=color;
  c.fill()
  c.lineTo(x-9, y+3)
  c.lineTo(x, y+20)
  c.lineTo(x+9, y+3)
  c.lineTo(x, y-8)
  c.lineTo(x-9, y+3)
  c.lineTo(x+9, y+3)
  c.lineTo(x+20, y)
  c.lineWidth = 1
  c.stroke()
  c.restore()
}

</script>
